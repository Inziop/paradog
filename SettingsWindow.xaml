<Window x:Class="ParadoxTranslator.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings - Paradox Translator" Height="600" Width="800"
        WindowStartupLocation="CenterOwner" ResizeMode="CanMinimize"
        Background="#1E1E1E" Foreground="White">
    
    <Grid>
        <Grid.Resources>
            <!-- Local header-style button for settings footer -->
            <Style x:Key="HeaderButtonStyle" TargetType="Button">
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="Background" Value="#007ACC"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Padding" Value="12,6"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Style.Triggers>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter Property="Background" Value="#2F2F2F"/>
                        <Setter Property="Foreground" Value="#BEBEBE"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- Ensure ComboBoxItems are dark and readable inside settings -->
            <Style x:Key="SettingsComboBoxItemStyle" TargetType="ComboBoxItem">
                <Setter Property="Background" Value="#2D2D30" />
                <Setter Property="Foreground" Value="White" />
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="#007ACC" />
                        <Setter Property="Foreground" Value="White" />
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#3E3E40" />
                        <Setter Property="Foreground" Value="White" />
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- ComboBox style for settings to ensure collapsed selection is readable -->
            <Style x:Key="SettingsComboBoxStyle" TargetType="ComboBox">
                <Setter Property="Background" Value="#2D2D30" />
                <Setter Property="Foreground" Value="White" />
                <Setter Property="BorderBrush" Value="#3C3C3C" />
                <Setter Property="Padding" Value="6,2" />
                <Setter Property="ItemContainerStyle" Value="{StaticResource SettingsComboBoxItemStyle}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ComboBox">
                            <Grid>
                                <Border x:Name="Bd" Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <!-- Important: Foreground bound to template Foreground -->
                                        <ContentPresenter Grid.Column="0"
                                            Content="{TemplateBinding SelectionBoxItem}"
                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                            ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"
                                            HorizontalAlignment="Left"/>
                                        <ToggleButton Grid.Column="1"
                                            IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                            Width="20" Height="20"
                                            Background="Transparent"
                                            BorderThickness="0">
                                            <Path Data="M0,0 L4,4 L8,0" 
                                                Stroke="White" StrokeThickness="2"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"/>
                                        </ToggleButton>
                                    </Grid>
                                </Border>
                                <Popup Name="PART_Popup"
                                       Placement="Bottom"
                                       IsOpen="{Binding Path=IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                       AllowsTransparency="True"
                                       Focusable="False"
                                       PopupAnimation="Slide">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="1">
                                        <ScrollViewer SnapsToDevicePixels="True">
                                            <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                        </ScrollViewer>
                                    </Border>
                                </Popup>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#2D2D30" Padding="20">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="⚙️" FontSize="24" Margin="0,0,10,0"/>
                <TextBlock Text="Settings" FontSize="20" FontWeight="Bold" 
                           Foreground="White" VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
        
        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Translation Engine -->
                <GroupBox Header="Translation Engine" Margin="0,0,0,20" 
                          Foreground="White" BorderBrush="#3C3C3C">
                    <StackPanel Margin="15">
                            <TextBlock Text="Select your preferred translation service:" 
                                       Margin="0,0,0,10" Foreground="#CCCCCC"/>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <CheckBox x:Name="EnableAICheckBox" Content="Enable AI translation" Foreground="White" Margin="0,0,15,0"/>
                                    <TextBlock Text="(" Foreground="#888888" VerticalAlignment="Center"/>
                                    <TextBlock Text="If enabled, translations use the configured AI engine and API key" Foreground="#888888" VerticalAlignment="Center"/>
                                    <TextBlock Text=")" Foreground="#888888" VerticalAlignment="Center"/>
                                </StackPanel>

                    <ComboBox x:Name="EngineComboBox" Width="200" Margin="0,0,0,15"
                            Style="{StaticResource SettingsComboBoxStyle}">
                        <ComboBoxItem Content="Google Translate" Tag="google" IsSelected="True"
                                     Background="#2D2D30" Foreground="White"/>
                        <ComboBoxItem Content="Google AI Studio (Gemini)" Tag="gemini"
                                     Background="#2D2D30" Foreground="White"/>
                        <ComboBoxItem Content="DeepL" Tag="deepl"
                                     Background="#2D2D30" Foreground="White"/>
                        <ComboBoxItem Content="OpenAI GPT" Tag="openai"
                                     Background="#2D2D30" Foreground="White"/>
                    </ComboBox>
                        
                            <TextBlock Text="Note: Each service requires its own API key. Google AI Studio (Gemini) provides more contextual translations." 
                                       FontSize="12" Foreground="#888888" Margin="0,5,0,0"/>
                        </StackPanel>
                </GroupBox>

                <!-- Glossary removed to restore original settings UI -->
                
                <!-- API Configuration -->
                <GroupBox Header="API Configuration" Margin="0,0,0,20" 
                          Foreground="White" BorderBrush="#3C3C3C">
                    <StackPanel Margin="15">
                        <TextBlock Text="API Keys (Optional - for premium features):" 
                                   Margin="0,0,0,10" Foreground="#CCCCCC"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" Text="Google API Key:" 
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" x:Name="GoogleApiKeyTextBox" 
                                     Background="#2D2D30" Foreground="White" 
                                     BorderBrush="#3C3C3C" Padding="8,4" Margin="0,0,10,0"/>
                <Button Grid.Column="2" Content="Test" Width="60" 
                    Style="{StaticResource HeaderButtonStyle}" Click="OnTestGoogleClick"/>
                        </Grid>
                        
                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" Text="DeepL API Key:" 
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" x:Name="DeepLApiKeyTextBox" 
                                     Background="#2D2D30" Foreground="White" 
                                     BorderBrush="#3C3C3C" Padding="8,4" Margin="0,0,10,0"/>
                <Button Grid.Column="2" Content="Test" Width="60" 
                    Style="{StaticResource HeaderButtonStyle}" Click="OnTestDeepLClick"/>
                        </Grid>

                        <Grid Margin="0,10,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Column="0" Text="Gemini API Key:" 
                                       VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" x:Name="GeminiApiKeyTextBox" 
                                     Background="#2D2D30" Foreground="White" 
                                     BorderBrush="#3C3C3C" Padding="8,4" Margin="0,0,10,0"/>
                <Button Grid.Column="2" Content="Test" Width="60" 
                    Style="{StaticResource HeaderButtonStyle}" Click="OnTestGeminiClick"/>
                        </Grid>

                        <!-- Gemini Endpoint (expandable/collapsible) -->
                        <Expander Header="Advanced: Gemini Endpoint" 
                                  Margin="0,10,0,0"
                                  Background="Transparent"
                                  Foreground="#CCCCCC"
                                  BorderThickness="0">
                            <Grid Margin="0,10,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" Text="API Endpoint:" 
                                           VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <TextBox Grid.Column="1" x:Name="GeminiEndpointTextBox" 
                                         Background="#2D2D30" Foreground="White" 
                                         BorderBrush="#3C3C3C" Padding="8,4"
                                         Text="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent"/>
                            </Grid>
                        </Expander>
                    </StackPanel>
                </GroupBox>
                
                <!-- Translation Settings -->
                <GroupBox Header="Translation Settings" Margin="0,0,0,20" 
                          Foreground="White" BorderBrush="#3C3C3C">
                    <StackPanel Margin="15">
                        <CheckBox x:Name="OverwriteExistingCheckBox" Content="Overwrite existing translations" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="True"/>
                        
                        <CheckBox x:Name="ValidatePlaceholdersCheckBox" Content="Validate placeholders automatically" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="True"/>
                        
                        <CheckBox x:Name="CreateBackupCheckBox" Content="Create backup before saving" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="True"/>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBlock Text="Max concurrent requests:" VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <TextBox x:Name="MaxConcurrentTextBox" Text="3" Width="60" 
                                     Background="#2D2D30" Foreground="White" 
                                     BorderBrush="#3C3C3C" Padding="8,4" 
                                     HorizontalContentAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
                <!-- UI Settings -->
                <GroupBox Header="Interface Settings" Margin="0,0,0,20" 
                          Foreground="White" BorderBrush="#3C3C3C">
                    <StackPanel Margin="15">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="Theme:" VerticalAlignment="Center" 
                                       Margin="0,0,10,0"/>
                            <ComboBox x:Name="ThemeComboBox" Width="150" 
                                              Style="{StaticResource SettingsComboBoxStyle}">
                                <ComboBoxItem Content="Dark" Tag="Dark" IsSelected="True"
                                                      Background="#2D2D30" Foreground="White"/>
                                <ComboBoxItem Content="Light" Tag="Light"
                                                      Background="#2D2D30" Foreground="White"/>
                                <ComboBoxItem Content="Auto" Tag="Auto"
                                                      Background="#2D2D30" Foreground="White"/>
                            </ComboBox>
                        </StackPanel>
                        
                        <CheckBox x:Name="ShowProgressAnimationsCheckBox" Content="Show progress animations" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="True"/>
                        
                        <CheckBox x:Name="AutoSaveCheckBox" Content="Auto-save every 5 minutes" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="False"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Advanced Settings -->
                <GroupBox Header="Advanced Settings" Margin="0,0,0,20" 
                          Foreground="White" BorderBrush="#3C3C3C">
                    <StackPanel Margin="15">
                        <TextBlock Text="Translation Quality:" Margin="0,0,0,10" Foreground="#CCCCCC"/>
                        <ComboBox x:Name="QualityComboBox" Width="200" 
                            Style="{StaticResource SettingsComboBoxStyle}" Margin="0,0,0,15">
                            <ComboBoxItem Content="Fast (Lower Quality)" Tag="Fast"
                                Background="#2D2D30" Foreground="White"/>
                            <ComboBoxItem Content="Balanced" Tag="Balanced" IsSelected="True"
                                Background="#2D2D30" Foreground="White"/>
                            <ComboBoxItem Content="High Quality (Slower)" Tag="High"
                                Background="#2D2D30" Foreground="White"/>
                        </ComboBox>
                        
                        <CheckBox x:Name="EnableLoggingCheckBox" Content="Enable detailed logging" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="False"/>
                        
                        <CheckBox x:Name="ShowDebugInfoCheckBox" Content="Show debug information" 
                                  Foreground="White" Margin="0,0,0,10" IsChecked="False"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Footer -->
        <Border Grid.Row="2" Background="#2D2D30" Padding="20" BorderBrush="#3C3C3C" BorderThickness="0,1,0,0">
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Reset to Defaults" Margin="0,0,10,0" 
                Background="#666666" Foreground="White" 
                BorderThickness="0" Padding="15,8" Cursor="Hand"
                Style="{StaticResource HeaderButtonStyle}"
                Click="OnResetClick"/>
            <Button Content="Cancel" Margin="0,0,10,0" 
                Background="#666666" Foreground="White" 
                BorderThickness="0" Padding="15,8" Cursor="Hand"
                Style="{StaticResource HeaderButtonStyle}"
                Click="OnCancelClick"/>
            <Button Content="Save Settings" 
                Background="#007ACC" Foreground="White" 
                BorderThickness="0" Padding="15,8" Cursor="Hand"
                Style="{StaticResource HeaderButtonStyle}"
                Click="OnSaveClick"/>
        </StackPanel>
        </Border>
    </Grid>
</Window>
